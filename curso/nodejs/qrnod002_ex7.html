<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livro Node.js - QRNOD002 - Exercício 7 - MySQL</title>
    <link rel="stylesheet" href="../../style.css">
    <script src="../../google-tag.js"></script>
</head>
<body>
    <div id="header-container"></div>
    <main>
        <section>
            <h1>Exercício 7: Atualizando Dados de um Usuário (UPDATE)</h1>
            <ul>
                <li>
                    <b>Descrição:</b> Crie uma função que receba um <b>Id</b> e um objeto com os dados a serem atualizados para um usuário na tabela <b>Usuario</b>. Exiba uma mensagem de sucesso ou erro.
                </li>
                <li>
                    <b>Conteúdo Teórico:</b>
                    <ul>
                        <li>A operação <b>UPDATE</b> é usada para modificar registros existentes em uma tabela.</li>
                        <li><b>UPDATE &lt;nome-da-tabela&gt; SET &lt;coluna1&gt; = ?, &lt;coluna2&gt; = ? WHERE &lt;condição&gt;</b>: Atualiza as colunas especificadas nas linhas que satisfazem a condição.</li>
                        <li>Sempre use a cláusula <b>WHERE</b> com UPDATE para evitar atualizar todas as linhas da tabela por engano.</li>
                    </ul>
                </li>
            </ul>
            <pre>
<b>Exemplo de Código:</b>
<code>
// app.js
const mysql = require('mysql2/promise');
async function updateUser(id, newData) {
let connection;
try {
connection = await mysql.createConnection({
host: 'localhost',
user: 'root',
password: '',
database: 'api_nodejs_db'
});
    const fields = Object.keys(newData).map(key => `${key} = ?`).join(', ');
    const values = Object.values(newData);
    values.push(id); // O ID é o último parâmetro para o WHERE

    const sql = `UPDATE Usuario SET ${fields} WHERE Id = ?`;

    const [result] = await connection.execute(sql, values);

    if (result.affectedRows > 0) {
        console.log(`Usuário com ID ${id} atualizado com sucesso!`);
    } else {
        console.log(`Nenhum usuário encontrado com ID ${id} para atualizar.`);
    }

} catch (error) {
    console.error('Erro ao atualizar usuário:', error);
} finally {
    if (connection) {
        await connection.end();
    }
}
}
// Teste a função
async function runUpdate() {
// Insira um usuário para ter algo para atualizar (se não tiver)
await insertUser();
// Encontre o ID de um usuário que você quer atualizar
const userToUpdateId = 1; // Substitua pelo ID de um usuário existente

const updatedData = {
    Nome: 'João Victor Silva',
    Email: 'joao.victor.silva@example.com',
    Telefone: 998765432
};

await updateUser(userToUpdateId, updatedData);

// Verifique se a atualização foi bem-sucedida listando o usuário
await findUserById(userToUpdateId);
}
runUpdate();
</code>
<b>Dica:</b>
Testar o UPDATE com um ID que não existe pode ser útil para ver o comportamento do affectedRows.
<b>Sugestão de Extensão:</b>
Crie uma função que permita atualizar apenas um campo específico do usuário, como o Email.
</pre>
        </section>
    </main>
    <div id="footer-container"></div>
    <script src="cabecalho.js"></script>
    <script src="rodape.js"></script>
</body>
</html>
